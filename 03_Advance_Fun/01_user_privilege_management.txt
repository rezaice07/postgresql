
POSTGRES DBA - USER PRIVILEGE MANAGEMENT
-----------------------------------------------
REFERENCES:
	https://www.youtube.com/watch?v=8YSp-wTELNs&ab_channel=databasetorque
	https://tableplus.com/blog/2018/04/postgresql-how-to-grant-access-to-users.html
	https://www.commandprompt.com/education/how-to-grant-all-privileges-to-users-in-postgresql/
	
#let's create role and user 

	CREATE ROLE SALES PASSWORD 'sales';
	CREATE USER USERA PASSWORD 'usera';
	CREATE USER USERB WITH LOGIN PASSWORD 'userb';

#let see the list of roles
	\du

#let's try to connect by using sales, usera and userb and will give different messages
	PS C:\Users\Reja> psql -U sales;
	Password for user sales:
	psql: error: connection to server at "localhost" (::1), port 5432 failed: FATAL:  role "sales" is not permitted to log in


	PS C:\Users\Reja> psql -U usera;
	Password for user usera:
	psql: error: connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "usera" does not exist

	PS C:\Users\Reja> psql -U userb;
	Password for user userb:
	psql: error: connection to server at "localhost" (::1), port 5432 failed: FATAL:  database "userb" does not exist

# A Connection by using the database for the users usera and userb
	PS C:\Users\Reja> psql -U usera -d postgres;
	Password for user usera:
	psql (16.0)
	WARNING: Console code page (437) differs from Windows code page (1252)
			 8-bit characters might not work correctly. See psql reference
			 page "Notes for Windows users" for details.
	Type "help" for help.

	postgres=> \q
	PS C:\Users\Reja> psql -U userb -d postgres;
	Password for user userb:
	psql (16.0)
	WARNING: Console code page (437) differs from Windows code page (1252)
			 8-bit characters might not work correctly. See psql reference
			 page "Notes for Windows users" for details.
	Type "help" for help.
	
	
	
# Let's try to create a databas by using user USERA

	PS C:\Users\Reja> psql -U usera -d postgres;

	postgres=> CREATE DATABASE TESTDB;
	ERROR:  permission denied to create database


	PS C:\Users\Reja> psql -U postgres -d postgres;
	Password for user postgres:
	psql (16.0)
	WARNING: Console code page (437) differs from Windows code page (1252)
			 8-bit characters might not work correctly. See psql reference
			 page "Notes for Windows users" for details.
	Type "help" for help.

# Let's create a database by the superuser POSTGRES
	PS C:\Users\Reja> psql -U postgres -d postgres;
	postgres=# CREATE DATABASE TESTDB;
	CREATE DATABASE

	PS C:\Users\Reja> psql -U usera -d testdb;
	Password for user usera:
	psql (16.0)
	WARNING: Console code page (437) differs from Windows code page (1252)
			 8-bit characters might not work correctly. See psql reference
			 page "Notes for Windows users" for details.
	Type "help" for help.

#Now we'll revoke public access from databas testdb by superuser postgres	
	PS C:\Users\Reja> psql -U postgres -d postgres;

	postgres=# revoke all on database testdb from public;
	REVOKE

#let's try to login user usera and it will show the error
	postgres=# \q
	PS C:\Users\Reja> psql -U usera -d testdb;
	Password for user usera:
	psql: error: connection to server at "localhost" (::1), port 5432 failed: FATAL:  permission denied for database "testdb"
	DETAIL:  User does not have CONNECT privilege.



#We have a role SALES and will assign to user USERA and USERB by superuser

PS C:\Users\Reja> psql -U postgres -d postgres;

	postgres=# GRANT SALES TO USERA;
	GRANT ROLE
	postgres=# GRANT SALES TO USERB;
	GRANT ROLE

#Now we will give connect permission to role sales
	postgres=# GRANT CONNECT ON DATABASE TESTDB TO SALES;
	GRANT
	
#Let's try to login	
	postgres=# \q
	PS C:\Users\Reja> psql -U usera -d testdb;
	Password for user usera:
	psql (16.0)
	WARNING: Console code page (437) differs from Windows code page (1252)
			 8-bit characters might not work correctly. See psql reference
			 page "Notes for Windows users" for details.
	Type "help" for help.
	
	
Last seen 16 mins


PS C:\Users\Dev> psql -U usera -d testdb;
Password for user usera:
psql (16.0)
WARNING: Console code page (437) differs from Windows code page (1252)
         8-bit characters might not work correctly. See psql reference
         page "Notes for Windows users" for details.
Type "help" for help.

testdb=> CREATE DATABASE TESTDB2;
ERROR:  permission denied to create database
testdb=> CREATE SCHEMA MY_SCHEMA;
ERROR:  permission denied for database testdb
testdb=> CREATE TABLE TEST_TAB(ID NUMBER,TITLE TEXT);
ERROR:  permission denied for schema public
LINE 1: CREATE TABLE TEST_TAB(ID NUMBER,TITLE TEXT);
                     ^
testdb=> CREATE USER TEST_USER WITH LOGIN PASSWORD '123';
ERROR:  permission denied to create role
DETAIL:  Only roles with the CREATEROLE attribute may create roles.
testdb=> CREATE TABLE TEST_TAB(ID INT,TITLE TEXT);
ERROR:  permission denied for schema public
LINE 1: CREATE TABLE TEST_TAB(ID INT,TITLE TEXT);
                     ^
testdb=> CREATE TABLE TEST_TAB(ID INT);
ERROR:  permission denied for schema public
LINE 1: CREATE TABLE TEST_TAB(ID INT);
                     ^
testdb=> \c postgres
You are now connected to database "postgres" as user "usera".
postgres=> REVOKE ALL ON SCHEMA PUBLIC FROM PUBLIC;
WARNING:  no privileges could be revoked for "public"
REVOKE
postgres=> REVOKE ALL ON SCHEMA  FROM PUBLIC;
ERROR:  relation "schema" does not exist






PS C:\Users\Dev> psql -U postgres -d postgres;
Password for user postgres:
psql (16.0)
WARNING: Console code page (437) differs from Windows code page (1252)
         8-bit characters might not work correctly. See psql reference
         page "Notes for Windows users" for details.
Type "help" for help.

postgres=# \c testdb
You are now connected to database "testdb" as user "postgres".
testdb=# revoke all on public from public;
ERROR:  relation "public" does not exist
testdb=# revoke all on schema public from public;
REVOKE
testdb=# \q
PS C:\Users\Dev> psql -U usera -d testdb;
Password for user usera:
psql (16.0)
WARNING: Console code page (437) differs from Windows code page (1252)
         8-bit characters might not work correctly. See psql reference
         page "Notes for Windows users" for details.
Type "help" for help.

testdb=> CREATE TABLE TEST_TAB(ID INT, TITLE TEXT);
ERROR:  no schema has been selected to create in
LINE 1: CREATE TABLE TEST_TAB(ID INT, TITLE TEXT);
                     ^
testdb=> show search_path;
   search_path
-----------------
 "$user", public
(1 row)


testdb=> CREATE TABLE TEST_TAB(ID INT, TITLE TEXT);
ERROR:  no schema has been selected to create in
LINE 1: CREATE TABLE TEST_TAB(ID INT, TITLE TEXT);
                     ^
testdb=> CREATE TABLE public.TEST_TAB(ID INT, TITLE TEXT);
ERROR:  permission denied for schema public
LINE 1: CREATE TABLE public.TEST_TAB(ID INT, TITLE TEXT);
                     ^
testdb=> schema: is a logical container;
ERROR:  syntax error at or near "schema"
LINE 1: schema: is a logical container;
        ^
testdb=> select current_user;
 current_user
--------------
 usera
(1 row)


testdb=> select count(*) from test_tab;
ERROR:  relation "test_tab" does not exist
LINE 1: select count(*) from test_tab;
                             ^
testdb=> select count(*) from test_tab;
ERROR:  relation "test_tab" does not exist
LINE 1: select count(*) from test_tab;
                             ^
testdb=>  select count(*) from test_tab;
ERROR:  permission denied for table test_tab
testdb=>  select count(*) from public.test_tab;
ERROR:  permission denied for table test_tab
testdb=> \d
          List of relations
 Schema |   Name   | Type  |  Owner
--------+----------+-------+----------
 public | test_tab | table | postgres
(1 row)


testdb=> alter table test_tab rename to tab_test;
ERROR:  must be owner of table test_tab
testdb=>



Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows

PS C:\Users\Dev> psql -U postgres -d postgres;
Password for user postgres:
psql (16.0)
WARNING: Console code page (437) differs from Windows code page (1252)
         8-bit characters might not work correctly. See psql reference
         page "Notes for Windows users" for details.
Type "help" for help.

postgres=# select * current_user;
ERROR:  syntax error at or near "current_user"
LINE 1: select * current_user;
                 ^
postgres=# select current_user;
 current_user
--------------
 postgres
(1 row)


postgres=# \c testdb;
You are now connected to database "testdb" as user "postgres".
testdb=# select * from test_tab;
ERROR:  relation "test_tab" does not exist
LINE 1: select * from test_tab;
                      ^
testdb=# CREATE TABLE public.TEST_TAB(ID INT, TITLE TEXT);
CREATE TABLE
testdb=# select count(*) from test_tab;
 count
-------
     0
(1 row)


testdb=# Now we will give permission to users or upper level role. let's see
testdb'# ;
testdb'# grant usage on schema public to sales;
testdb'# \q
Use control-C to quit.
testdb'# \q
Use control-C to quit.
testdb'# \q
PS C:\Users\Dev> psql -U postgres -d postgres;
Password for user postgres:
psql (16.0)
WARNING: Console code page (437) differs from Windows code page (1252)
         8-bit characters might not work correctly. See psql reference
         page "Notes for Windows users" for details.
Type "help" for help.

postgres=# \c testdb;
You are now connected to database "testdb" as user "postgres".
testdb=# grant usage on schema public to sales;
GRANT
testdb=# grant create on schema public to sales;
GRANT
testdb=#  alter table test_tab rename to tab_test;
ALTER TABLE
testdb=#  alter table tab_test rename to test_tab;
ALTER TABLE
testdb=#

